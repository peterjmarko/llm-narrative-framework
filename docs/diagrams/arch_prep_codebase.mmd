graph TD
    classDef scriptStyle fill:#fff2cc,stroke:#d6b656,stroke-width:2px
    classDef utilStyle fill:#e6e6fa,stroke:#333,stroke-width:2px
    subgraph Main Data Preparation Pipeline
        A[src/fetch_adb_data.py] --> B[src/find_wikipedia_links.py]
        B --> B2[src/validate_wikipedia_pages.py]
        B2 --> C[src/select_eligible_candidates.py]
        C --> D["src/generate_eminence_scores.py<br/>(Uses LLM)"]
        D --> E["src/generate_ocean_scores.py<br/>(Uses LLM)"]
        E --> F[src/select_final_candidates.py]
        F --> G[src/prepare_sf_import.py]
        G --> H[src/create_subject_db.py]
        H --> I[src/generate_personalities_db.py]
    end
    
    subgraph Delineation Processing
        J["src/neutralize_delineations.py<br/>(Uses LLM)"]
    end

    J --> I
    J --> H

    subgraph Shared Utilities
        K(src/id_encoder.py)
    end

    G -.-> K
    H -.-> K

    %% Apply Styles
    class A,B,B2,C,D,E,F,G,H,I,J scriptStyle
    class K utilStyle