graph TD
    subgraph "1. Main User Entry Points"
        direction LR
        new_experiment_ps1["new_experiment.ps1"]
        audit_experiment_ps1["audit_experiment.ps1"]
        fix_experiment_ps1["fix_experiment.ps1"]
        migrate_experiment_ps1["migrate_experiment.ps1"]
        audit_study_ps1["audit_study.ps1"]
        fix_study_ps1["fix_study.ps1"]
        migrate_study_ps1["migrate_study.ps1"]
        evaluate_study_ps1["evaluate_study.ps1"]
    end

    subgraph "2. Experiment-Level Orchestration"
        exp_manager["experiment_manager.py"]
        exp_auditor["experiment_auditor.py"]
    end
    
    subgraph "4. Study-Level Analysis"
        compile_study_results_py["compile_study_results.py"]
        study_analysis["analyze_study_results.py"]
    end

    subgraph "3. Single Replication Pipeline"
        replication_manager["replication_manager.py"]
        
        subgraph "Pipeline Stages (executed by replication_manager.py)"
            direction TB
            stage1["1. build_llm_queries.py"]
            stage2["2. llm_prompter.py (in parallel)"]
            stage3["3. process_llm_responses.py"]
            stage4["4. analyze_llm_performance.py"]
            stage4b["5. run_bias_analysis.py"]
            stage5["6. generate_replication_report.py"]
            stage6["7. compile_replication_results.py"]
        end
        query_generator["query_generator.py"]
    end

    subgraph "Utility & Other Scripts"
        log_manager["manage_experiment_log.py"]
        compile_experiment["compile_experiment_results.py"]
        patch_old["patch_old_experiment.py"]
        config_loader["config_loader.py"]
    end

    %% --- Connections ---
    new_experiment_ps1 --> exp_manager
    
    audit_experiment_ps1 --> exp_auditor
    audit_study_ps1 --> exp_auditor
    
    fix_experiment_ps1 --> exp_auditor
    fix_experiment_ps1 --> exp_manager
    fix_study_ps1 --> exp_auditor
    fix_study_ps1 --> exp_manager
    
    migrate_experiment_ps1 --> exp_auditor
    migrate_experiment_ps1 --> exp_manager
    migrate_study_ps1 --> exp_auditor
    migrate_study_ps1 --> exp_manager

    evaluate_study_ps1 --> compile_study_results_py
    evaluate_study_ps1 --> study_analysis

    exp_manager --> replication_manager
    exp_manager --> compile_experiment
    exp_manager --> log_manager
    exp_manager -.-> patch_old

    %% Sequential Pipeline Execution
    replication_manager --> stage1
    stage1 --> stage2
    stage2 --> stage3
    stage3 --> stage4
    stage4 --> stage4b
    stage4b --> stage5
    stage5 --> stage6

    %% Worker Connections
    stage1 -.-> query_generator

    %% Import Connections (dotted)
    exp_manager -.-> exp_auditor
    exp_manager & exp_auditor & replication_manager & stage1 & stage2 & stage3 & stage4 & stage4b & stage5 & stage6 & query_generator & log_manager & compile_experiment & compile_study_results_py & study_analysis & patch_old -.-> config_loader

    %% --- Inline Styling ---
    style new_experiment_ps1 fill:#cde4ff,stroke:#6c93be
    style audit_experiment_ps1 fill:#cde4ff,stroke:#6c93be
    style fix_experiment_ps1 fill:#cde4ff,stroke:#6c93be
    style migrate_experiment_ps1 fill:#cde4ff,stroke:#6c93be
    style audit_study_ps1 fill:#cde4ff,stroke:#6c93be
    style fix_study_ps1 fill:#cde4ff,stroke:#6c93be
    style migrate_study_ps1 fill:#cde4ff,stroke:#6c93be
    style evaluate_study_ps1 fill:#cde4ff,stroke:#6c93be

    style exp_manager fill:#fff3cd,stroke:#f1c40f
    style exp_auditor fill:#fff3cd,stroke:#f1c40f
    
    style compile_study_results_py fill:#d1e7dd,stroke:#0f5132
    style study_analysis fill:#d1e7dd,stroke:#0f5132
    
    style replication_manager fill:#fdebd0,stroke:#e59866
    style query_generator fill:#fdebd0,stroke:#e59866
    
    style stage1 fill:#d4edda,stroke:#155724
    style stage2 fill:#d4edda,stroke:#155724
    style stage3 fill:#d4edda,stroke:#155724
    style stage4 fill:#d4edda,stroke:#155724
    style stage4b fill:#d4edda,stroke:#155724
    style stage5 fill:#d4edda,stroke:#155724
    style stage6 fill:#d4edda,stroke:#155724

    style log_manager fill:#e9ecef,stroke:#adb5bd
    style compile_experiment fill:#e9ecef,stroke:#adb5bd
    style patch_old fill:#e9ecef,stroke:#adb5bd
    style config_loader fill:#e9ecef,stroke:#adb5bd