flowchart TD
    %% Style Definitions
    classDef startEnd fill:#e6e6fa,stroke:#333,stroke-width:2px
    classDef process fill:#e0ffff,stroke:#333,stroke-width:2px
    classDef fileIO fill:#f0fff0,stroke:#333,stroke-width:2px

    subgraph col1 ["Finalization"]
        G{"Sort final list by<br/>eminence score descending"}
        H["Write final list to<br/>adb_final_candidates.txt"]
        I[End]
        G --> H --> I
    end

    subgraph col2 ["Filtering & Transformation"]
        C{"Create set of final subject IDs<br/>from OCEAN scores file"}
        D{"Filter eligible candidates list<br/>by final ID set"}
        E{"Resolve 'CountryState' code<br/>to full 'Country' name"}
        F{"Join with eminence scores"}
        F_cont((To Finalization))
        C --> D --> E --> F --> F_cont
    end
    
    subgraph col3 ["Setup"]
        A[Start]
        B{"Load all required data:<br/>- Eligible Candidates<br/>- OCEAN Scores<br/>- Eminence Scores<br/>- Country Codes"}
        B_cont(("To Filtering &<br/>Transformation"))
        A --> B --> B_cont
    end
    
    %% Apply Styles
    class A,I startEnd
    class C,D,E,F,G,B_cont,F_cont process
    class B,H fileIO