graph TD
    subgraph "Input Data"
        direction LR
        Input_PDB["personalities_db<br/>1-5000.txt"]:::input
        Input_Query["base_query.txt"]:::input
        Input_Config["config.ini"]:::input
    end

    subgraph "Core Data Pipeline Flow"
        direction LR
        subgraph "1: Generation"
             Script1["build_llm_queries.py"]:::script
        end
        subgraph "2: Execution & Processing"
            Script2["run_llm<br/>_sessions.py"]:::script
            Script3["process_llm<br/>_responses.py"]:::script
        end
        subgraph "3: Single-Run Analysis"
            Script4["analyze_llm<br/>_performance.py"]:::script
        end
        subgraph "4: Study-Level Aggregation & Analysis"
             Aggregator["experiment_aggregator.py"]:::script
             StudyAnalyzer["study_analysis.py"]:::script
        end
    end

    subgraph "Key Data Artifacts"
        direction LR
        Art1_archive[("config.ini.archived")]:::artifact
        Art1_query["llm_query_XXX.txt"]:::artifact
        Art1_mappings_src[("mappings.txt<br/>(source)")]:::artifact
        Art1_manifest[("manifest.txt")]:::artifact
        Art2_response["llm_response_XXX.txt"]:::artifact
        Art3_scores["all_scores.txt"]:::artifact
        Art3_mappings_analysis["all_mappings.txt<br/>(for analysis)"]:::artifact
        Art4_report["replication_report.txt"]:::artifact
        BatchRunLog[("batch_run_log.csv")]:::artifact
        RepResultsCSV[("REPLICATION_results.csv")]:::artifact
        ExpResultsCSV[("EXPERIMENT_results.csv")]:::artifact
        StudyResultsCSV[("STUDY_results.csv")]:::artifact
        FinalOutputs(("STUDY_analysis_log.txt<br/>Boxplots/<br/>Diagnostics/")):::final
    end

    %% Connections reflecting data flow
    Input_PDB & Input_Query & Input_Config --> Script1
    Input_Config --> Art1_archive

    Script1 --> Art1_query
    Script1 --> Art1_mappings_src
    Script1 --> Art1_manifest

    Art1_query --> Script2
    Script2 --> Art2_response

    Art2_response & Art1_mappings_src & Art1_manifest --> Script3
    Script3 --> Art3_scores
    Script3 --> Art3_mappings_analysis

    Art3_scores & Art3_mappings_analysis & Art1_archive --> Script4
    Script4 --> Art4_report

    Art4_report --> BatchRunLog
    Art4_report --> Aggregator
    Art1_archive --> Aggregator

    Aggregator --> RepResultsCSV
    Aggregator --> ExpResultsCSV
    Aggregator --> StudyResultsCSV

    StudyResultsCSV --> StudyAnalyzer
    StudyAnalyzer --> FinalOutputs

    classDef input fill:#cde4ff,stroke:#6c93be,color:#333
    classDef script fill:#ffe8d6,stroke:#e59866,color:#333
    classDef artifact fill:#e9ecef,stroke:#adb5bd,color:#333
    classDef final fill:#d4edda,stroke:#155724,color:#333 font-weight:bold