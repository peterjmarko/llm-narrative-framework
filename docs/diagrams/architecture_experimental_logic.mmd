graph TD
    %% 1. Define All Nodes
    A["Start: Pool of 5000 Personalities"]
    B{"Sample 100 sets"}
    C{"Sample k=10"}
    D["Shuffle Names<br/>& Descriptions"]
    Input[config.ini]:::input
    M{"Define Ground Truth"}
    F(("LLM Task:<br/>Score Similarity"))
    G["Receive 10x10<br/>Score Matrix"]
    H{"Calculate<br/>Trial Metrics"}
    I{"Collect & Aggregate<br/>100 Trial Metrics"}
    K(["Final Replication<br/>Data Point"]):::final

    %% 2. Define All Connections
    A --> B --> C
    C --> D
    
    %% This is the corrected detail, as per your instruction
    Input -- "Provides Mapping Strategy<br/>(Correct vs. Random)" --> M
    
    D & M --> F
    F --> G --> H
    H --> I --> K
    
    %% 3. Group Nodes into Subgraphs using their IDs
    subgraph "Single Trial (Repeated 100 times)"
        C
        F
        G
        H
        subgraph "Task Setup"
            direction LR
            D
            M
        end
    end

    %% 4. Styling
    classDef final fill:#d4edda,stroke:#155724;
    classDef input fill:#e9d8fd,stroke:#9467bd;
