graph TD
    %% 1. Define All Nodes
    A(["Start: Pool of 5000 Personalities"]):::start_end_node
    C{"Sample `k` Unique Personalities<br/>(from Pool, without replacement)"}
    DrawingSeed[Drawing Seed]:::input
    D["Shuffle Names & Descriptions<br/>(for `k` Personalities)"]
    ShufflingSeed[Shuffling Seed]:::input
    Input[config.ini]:::input
    M{"Define Ground Truth Mapping"}
    F(("LLM Task:<br/>Score Similarity"))
    G["Receive Score Matrix"]
    H{"Calculate Trial Metrics"}
    I{"Aggregate Replication Metrics"}
    K(["Final Replication<br/>Data Point"]):::start_end_node

    %% 2. Define All Connections
    A --> C
    DrawingSeed --> C
    
    C --> D
    ShufflingSeed --> D
    
    Input -- "Provides Mapping Strategy<br/>(Correct vs. Random)" --> M
    
    D --> F
    M --> H
    F --> G --> H
    H --> I --> K
    
    %% 3. Group Nodes into Subgraphs using their IDs
    subgraph "Single Trial (Repeated `m` times)"
        C
        F
        G
        H
        subgraph "Task Setup"
            direction LR
            D
            M
        end
    end

    %% 4. Styling
    classDef start_end_node fill:#d4edda,stroke:#155724;
    classDef input fill:#e9d8fd,stroke:#9467bd;