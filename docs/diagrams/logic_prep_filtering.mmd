graph TD
    subgraph "Logic for filter_adb_candidates.py"
        A[Start] --> B{Load validation report and OCEAN subject IDs};
        B --> C{Loop through each line in raw ADB export};

        subgraph "Stage 1: Initial Filtering"
            C --> D{"Is Duplicate by<br/>Norm Name and Date"};
            D -- Yes (Skip) --> C;
            D -- No --> E{"Is Status OK"};
            E -- No --> C;
            E -- Yes --> F{"Birth Year 1900-1999"};
            F -- No --> C;
            F -- Yes --> G{"Valid Birth Time"};
            G -- No --> C;
            G -- Yes --> H[Add to Stage 1 Candidates list];
            H --> C;
        end

        C -- End of File --> I{Start Stage 2};

        subgraph "Stage 2: OCEAN Set Selection"
            I --> J{Filter Stage 1 list to keep only<br/>subjects present in the OCEAN ID set};
            J --> K{Load eminence scores};
            K --> L{Join candidates with their eminence scores};
            L --> M{"Sort final list by<br/>eminence score descending"};
            M --> N[Write final list to adb_filtered_final.txt];
            N --> O[End];
        end
    end
    