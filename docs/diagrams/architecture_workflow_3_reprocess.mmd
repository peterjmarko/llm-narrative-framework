graph TD
    %% Define Nodes
    EntryPoint["replication_manager.py --reprocess<br/>(Entry Point & Batch Controller)"]:::entry
    
    Orchestrate["1. orchestrate_replication.py --reprocess<br/>(Runs Stages 3 & 4)"]:::layer_green
    BiasAnalysis["2. run_bias_analysis.py"]:::script
    
    LogManager["3. log_manager.py (rebuild)"]:::danger
    CompileResults["4. compile_results.py"]:::script

    %% Define Connections
    EntryPoint --> Orchestrate
    Orchestrate --> BiasAnalysis
    BiasAnalysis --> LogManager
    LogManager --> CompileResults

    %% Group Nodes into Subgraphs
    subgraph "Reprocessing Loop (for each run)"
        Orchestrate
        BiasAnalysis
    end

    subgraph "Finalization (after loop)"
        LogManager
        CompileResults
    end

    %% Styling
    classDef entry fill:#f0ad4e,stroke:#eea236,color:#333;
    classDef layer_green fill:#5cb85c,stroke:#4cae4c,color:#fff;
    classDef script fill:#5bc0de,stroke:#46b8da,color:#fff;
    classDef danger fill:#d9534f,stroke:#d43f3a,color:#fff;
