graph TD
    subgraph "1. Main User Entry Points"
        direction LR
        new_experiment_ps1["new_experiment.ps1"]
        run_experiment_ps1["run_experiment.ps1"]
        audit_experiment_ps1["audit_experiment.ps1"]
        update_experiment_ps1["update_experiment.ps1"]
        migrate_experiment_ps1["migrate_experiment.ps1"]
        audit_study_ps1["audit_study.ps1"]
        process_study_ps1["process_study.ps1"]
    end

    subgraph "2. Experiment Lifecycle"
        direction TB
        exp_manager["experiment_manager.py"]
        orchestrator["orchestrate_replication.py"]
        
        subgraph "Pipeline Stages"
            direction TB
            build_queries["build_llm_queries.py"]
            run_sessions["run_llm_sessions.py"]
            process_responses["process_llm_responses.py"]
            subgraph "Analyze LLM Performance"
                direction TB
                analyze_performance["analyze_llm_performance.py"]
                run_bias["run_bias_analysis.py"]
            end
            generate_report["generate_replication_report.py"]
            compile_replication["compile_replication_results.py"]
        end
        
        subgraph "Pipeline Workers"
            direction TB
            query_generator["query_generator.py"]
            llm_prompter["llm_prompter.py"]
        end

        log_manager["replication_log_manager.py"]
    end

    subgraph "3. Data Migration Processes"
        direction TB
        patch_old["patch_old_experiment.py"]
        restore_config["restore_config.py"]
        rebuild_reports["rebuild_reports.py"]
    end

    subgraph "4. Study-Level Analysis"
        direction TB
        compile_experiment["compile_experiment_results.py"]
        agg_exps["aggregate_experiments.py"]
        study_analysis["study_analysis.py"]
    end

    subgraph "5. Shared Utilities"
        direction TB
        config_loader["config_loader.py"]
    end
    
    %% --- Main Workflow Connections ---
    new_experiment_ps1 --> exp_manager
    run_experiment_ps1 --> exp_manager
    update_experiment_ps1 --> exp_manager
    audit_experiment_ps1 --> exp_manager
    audit_study_ps1 --> exp_manager
    migrate_experiment_ps1 --> exp_manager
    process_study_ps1 --> agg_exps

    exp_manager --> orchestrator
    exp_manager --> compile_experiment
    exp_manager --> log_manager
    exp_manager -.-> patch_old
    exp_manager -.-> rebuild_reports

    orchestrator --> build_queries
    orchestrator --> run_sessions
    orchestrator --> process_responses
    orchestrator --> analyze_performance
    orchestrator --> run_bias
    orchestrator --> generate_report
    orchestrator --> compile_replication

    build_queries --> query_generator
    run_sessions --> llm_prompter

    agg_exps --> study_analysis

    %% --- Migration Workflow Connections ---
    patch_old --> restore_config
    rebuild_reports --> process_responses
    rebuild_reports --> analyze_performance
    rebuild_reports --> run_bias

    %% --- Import Connections (Dotted Lines) ---
    exp_manager         -.-> config_loader
    orchestrator        -.-> config_loader
    build_queries       -.-> config_loader
    run_sessions        -.-> config_loader
    process_responses   -.-> config_loader
    analyze_performance -.-> config_loader
    run_bias            -.-> config_loader
    query_generator     -.-> config_loader
    llm_prompter        -.-> config_loader
    patch_old           -.-> config_loader
    restore_config      -.-> config_loader
    rebuild_reports     -.-> config_loader
    agg_exps            -.-> config_loader
    study_analysis      -.-> config_loader
    log_manager         -.-> config_loader
    generate_report     -.-> config_loader
    compile_replication -.-> config_loader
    compile_experiment  -.-> config_loader